  main:
    params: [event]
    steps:
        - log_event:
            call: sys.log
            args:
                text: ${event}
                severity: INFO
        - extract_bucket_object:
            assign:
            - bucket: ${event.data.bucket}
            - object: ${event.data.name}
            - md5hash: ${event.data.md5Hash}
        - VirusTotal_scan:
            call: http.post
            args:
              url: https://ruby-virus-scan-yspciwmbia-uc.a.run.app
              body: 
                bucket: ${bucket}
                object: ${object}
                md5hash: ${md5hash}
            result: api_response1
        - log_api_response1:
            call: sys.log
            args:
              json: ${api_response1}
        - extract_score:
            assign:
              - score: ${api_response1.body.score}
        - move_file:
            call: http.post
            args:
              url: https://ruby-move-file-yspciwmbia-uc.a.run.app
              body: 
                score:  ${score}
                bucket: ${bucket}
                object: ${object}
            result: file_status
        - return_message:
            return: ${file_status}
